<!doctype html>
<html lang="en">

    <head>

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
        <title>Client/Server applications</title>
    
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/reveal.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/theme/white.css" id="theme">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/zenburn.min.css">
        
        <link rel="stylesheet" href="./fontawesome-6.2.0/css/all.min.css">
        <link rel="stylesheet" href="./style.css">
    
        <script src="print.js"></script>
    
    </head>

	<body>

		<div class="reveal">
			<div class="slides">
                <section>
                    <section data-background="#333333">
                        <h2>Web</h2>
                        <h1>Iterators and Client-Server</h1>
                        <p>Olivier Lemer</p>
        
                        <aside class="notes">
                        Slides by Bertil Chapuis, Olivier Lemer
                        </aside>  
                    </section>
                    <section data-markdown>
                        <textarea data-template>
                            ## <i class="fas fa-tasks"></i> Overview of Today's Class
                            - Arrays and Iterables
                            - Client-Server Applications
                        </textarea>
                    </section>
                </section>

                <section>
                    <section data-background="#333333">
                        <h2><i class="fab fa-js"></i> Javascript Arrays and Iterables</h2>
                    </section>
                    <section data-markdown style="font-size: 0.6em;">
                        <textarea data-template>
                            ## <i class="fab fa-js"></i> Arrays methods
                            Recall the Array object. Its prototype has many methods. Some of the useful ones are:

                            - `concat()` concatenates two or more arrays and returns a new array.
                            - `join()` joins all elements of an array into a string.
                            - `pop()` removes the last element from an array and returns that element.
                            - `push()` adds one or more elements to the end of an array and returns the new length of the array.
                            - `reverse()` reverses the order of the elements of an array.
                            - `shift()` removes the first element from an array and returns that element.
                            - `slice()` selects a part of an array, and returns it as a new array.
                            - `sort()` sorts the elements of an array.

                            https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array
                        
                        </textarea>
                    </section>
                    <section data-markdown style="font-size: 0.6em;">
                        <textarea data-template>
                            ## <i class="fab fa-js"></i> Array's functional methods (1/2)

                            The Array object also has some functional methods, which are:

                            `forEach()` executes a provided function once for each array element.

                            ```js
                            const a = ['a', 'b', 'c'];
                            a.forEach(element => console.log(element));
                            ```

                            `map()` creates a new array with the results of calling a provided function on every element.
                            
                            ```js
                            var a = ["apple", "banana", "pear"];
                            a.map(a => a.length)
                            ```

                            `flatMap()` maps each element using a mapping function, and then flattens the resulting array by one level.

                            ```js
                            var a = ['Yverdon is', 'a', 'beautiful city'];
                            a.flatMap(s => s.split(" "));
                            // First executes map: [['Yverdon', 'is'], 'a', ['beautiful', 'city']]
                            // Then flattens: ['Yverdon', 'is', 'a', 'beautiful', 'city'].
                            ```

                            `filter()` creates a new array with all elements that pass the test implemented by the provided function.

                            ```js
                            const words = ['Yverdon', 'is', 'a', 'beautiful', 'city'];
                            const result = words.filter(word => word.length > 6);
                            ```

                            https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array

                            Notes:

                            Flattenning an array by depth `n` means replacing any sub-array it contains with the elements contained by that subarray, `n` times. Note that a `flat` method exists in `Array.prototype` which does exactly that, meaning that `flatMap` is equivalent to calling `map` and then `flat`.
                        </textarea>
                    </section>
                    <section data-markdown style="font-size: 0.6em;">
                        <textarea data-template>
                            ## <i class="fab fa-js"></i> Array's functional methods (2/2)

                            `reduce()` and `reduceRight()` execute a reducer function on each element of the array, resulting in a single value.

                            ```js
                            var a = [1, 2, 3];
                            a.reduce((acc, v, i) => ac + v, initialValue)
                            ```

                            `every()` tests whether all elements in the array pass the provided predicate

                            ```js
                            var a = [1, 2, 3];
                            a.every(a => a > 0)
                            ```

                            `some()` tests whether some element in the array passes the provided predicate

                            ```js
                            var a = [1, 2, 3];
                            a.some(a => a > 2)
                            ```

                            `find()` and `findIndex()` return the value (or its index, respectively) of the first element in the array that satisfies the provided predicate.

                            ```js
                            var a = [1, 2, 3];
                            a.find(a => a > 2)
                            ```

                            https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array

                        </textarea>
                    </section>
                    <section data-markdown data-visibility="hidden" style="font-size: 0.6em;">
                        <textarea data-template>
                            ## <i class="fas fa-hand-paper"></i> Inverted Index

                            Given a list of documents, create an inverted index. An inverted index is a dictionary where each word is associated with a list of the document identifiers in which that word appears.

                            ```js
                            let documents = [
                                "Hello Everyone",
                                "Hello, World!",
                                "The sky is blue",
                                "The sky is dark"
                            ];
                            let stopWords = ["the", "is"];
                            let invertedIndex = "...";
                            ```

                            Use the `replace`, `split`, `filter`, `map`, `flatMap`, and `reduce` methods to create the inverted index so that `console.log(invertedIndex)` prints:

                            ```js
                            {
                                "hello": [ 0, 1 ],
                                "everyone": [ 0 ],
                                "world": [ 1 ],
                                "sky": [ 2, 3 ],
                                "blue": [ 2 ],
                                "dark": [ 3 ]
                            }
                            ```
                          
                            Notes:
                            
                            <div class="spoiler">
                            
                            Solution:

                            ```js
                            let documents = [
                                "Hello Everyone",
                                "Hello, World!",
                                "The sky is blue",
                                "The sky is dark"
                            ];
                            let stopWords = ["the", "is"];
                            let invertedIndex = documents
                                .map((doc, index) => doc
                                    .replace(/[.,!]/g, "")
                                    .split(" ")
                                    .filter(word => !stopWords.includes(word.toLowerCase()))
                                    .map(word => [word.toLowerCase(), index]))
                                .flat()
                                .reduce((acc, [word, index]) => {
                                    if (acc[word]) {
                                        acc[word].push(index);
                                    } else {
                                        acc[word] = [index];
                                    }
                                    return acc;
                                }, {});
                            console.log(invertedIndex);
                            ```
                            
                            </div>
                            
                        </textarea>
                    </section>

                    <section data-markdown style="font-size: 0.6em">
                      <textarea data-template>
                        ## <i class="fab fa-js"></i> Iterators

                        **Iterators** are objects that provide a `next()` method which returns an object with two properties:

                        - `value`: the next value in the iterator, and
                        - `done`: whether the last value has already been provided.

                        **Iterables** are objects that have a `Symbol.iterator` method that returns an iterator over them.

                        ```js
                        let idGenerator = {};

                        idGenerator[Symbol.iterator] = function() {
                            return {
                                nextId: 0,
                                next() {
                                    if (this.nextId < 10) {
                                        return { value: this.nextId++, done: false };
                                    } else {
                                        return { done : true };
                                    }
                                }
                            }
                        }

                        for (let id of idGenerator) {
                            console.log(id);
                        }
                        ```

                        *Recall: The `for...of` loop requires its second operand to be an iterable.*

                      </textarea>
                    </section>

                    <section data-markdown style="font-size: 0.7em;">
                        <textarea data-template>
                            ## <i class="fab fa-js"></i> Generators - Convenient iterators

                            Allows the definition of a function that can "return multiple times" with the `yield` keyword:

                            ```js[3-8]
                            let idGenerator = {};

                            idGenerator[Symbol.iterator] = function* () {
                                let nextId = 0;
                                while (nextId < 10) {
                                    yield nextId++;
                                }
                            };

                            for (let id of idGenerator) {
                                console.log(id);
                            }
                            ```

                            - `function*` declares a generator, which is a type of iterator, *not* a function.
                            - `yield` effectively pauses execution after returning its operand. On a next call to the iterator, it will resume execution.
                            - `yield*` is followed by another generator or iterable object and delegates the generation to them until they are empty.

                            Notes:

                            ### Remarks

                            When used as a class method, since there is no `function` keyword, the asterisk is put before the name :
                            ```js
                            class Foo {
                                *bar() {
                                    yield 1;
                                }
                            }
                            ```

                        </textarea>
                    </section>

                    <section data-markdown style="font-size: 0.8em;">
                        <textarea data-template>
                            ## <i class="fab fa-js"></i> Useful Built-in Iterables

                            The `Map` and `Set` objects are iterable and have a `forEach` method.


                            The `Map` object holds key-value pairs and remembers the original insertion order of the keys.

                            ```js
                            let map = new Map();
                            map.set("key", "value");
                            map.get("key");
                            map.delete("key");
                            ```

                            The `Set` object lets you store unique values of any type.

                            ```js
                            let set = new Set();
                            map.add("value");
                            map.has("value");
                            map.delete("value");
                            ```

                            https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Object

                            Notes:

                            The iterable for Map iterates over its entries, which are arrays of the form [key, value]. Hence, the `forEach` method takes a callback function with two arguments, the key and the value:

                            ```js
                            map.forEach((key, value) => console.log(key, value));
                            ```

                            Similarly if using the `for of` syntax:

                            ```js
                            for (let [key, value] of map) {
                                console.log(key, value);
                            }
                            ```
                            
                        </textarea>
                    </section>

                    <section data-markdown style="font-size: 0.8em;">
                        <textarea data-template>
                            ## <i class="fab fa-js"></i> Hands on !

                            Rendez-vous sur [la plateforme de test en ligne](https://eval.iict-heig-vd.in/jam-sessions/clnu80zhw00opqu0pbz62lm9t). Le VPN est nécessaire pour y accéder.

                            Ceci n'est pas noté, et les solutions seront ajoutées ici-même après le cours.
                            
                        </textarea>
                    </section>
                </section>
                
                <section>
                    <section data-background="#333333">
                        <h2><i class="fab fa-js"></i> Client-Server Applications</h2>
                    </section>

                    <section data-markdown style="font-size: 0.8em;">
                        <textarea data-template>
                            ## <i class="fas fa-cogs"></i> Anatomy of a web application                            

                            <img src="images/client-server.png" alt="client/server" style="width: 80%;" />

                            https://developer.mozilla.org/en-US/docs/Learn/Server-side/First_steps/Client-Server_overview

                            Notes:

                            1. The client makes an HTTP GET request to the server
                            2. The server receives the request and forwards the requested data to the web application
                            3. The web application might query a database to obtain necessary data for the response
                            4. The web application generates an HTML page and sends it back to the web server
                            5. The web server sends the HTTP response containing the document to the client
                            6. The client renders the document. If it contains references to external resources, the client makes additional HTTP requests to the web server.
                            7. The web server might also retrieve files directly from the file system, for example images, CSS stylesheets, or JavaScript files.

                        </textarea>
                    </section>

                    
                    <section data-markdown style="font-size: 0.6em;">
                        <textarea data-template>
                            ## <i class="fas fa-cogs"></i> HTML Forms (Client-side)        

                            HTML forms are the most common way to collect user input, send it to a server, and receive a response. The form itself is written in HTML, and the server's response is typically HTML as well.

                            ```html
                            <form action='/form.php' method='POST'>
                                <label for="email">E-mail:</label>
                                <input type="email" id="email" name="email" />
                                <label>Title:
                                    <input type="text" id="title" name="title" />
                                </label>
                                <label for="content">Content:</label>
                                <textarea id="content" name="content" />
                                <button type="submit">Save</button>
                            </form>
                            ```

                            - The form's action attribute defines where the form data is sent.
                            - The form's method attribute defines how the data is sent.
                            - The form's input elements define the data fields the form collects.
                            - The form's button element defines the button the user clicks to send the data to the server.
                            
                            https://developer.mozilla.org/en-US/docs/Learn/HTML/Forms/Your_first_HTML_form
                        
                        </textarea>
                    </section>

                    <section data-markdown style="font-size: 0.6em;">
                        <textarea data-template>
                            ## <i class="fas fa-cogs"></i> HTML Forms (Server-side)        

                            The server-side code that processes the form data is typically written in a server-side language such as PHP, Python, or Java. 
                         
                            ```php
                            <?php
                                $email = $_POST['email'];
                                $title = $_POST['title'];
                                $content = $_POST['content'];
                                
                                // Do something with the data...
                                
                                echo "Thank you for your message!";
                            ?>
                            ```

                            Here, the server-side code retrieves the data from the form using the $_POST array. 
                            The data is then processed and a response is sent back to the client.

                        </textarea>
                    </section>

                    <section data-markdown style="font-size: 0.8em;">
                        <textarea data-template>
                            ## <i class="fab fa-js"></i> ExpressJS (Server-side)

                            Today, Javascript is a popular choice for server-side programming.

                            Express is a minimal and flexible Node.js web application framework that provides a robust set of features for web applications.

                            Web frameworks usually come with:
                            - A **middleware** layer that processes HTTP requests and responses.
                            - A **router** that helps at mapping HTTP requests to the appropriate code.
                            - A **template engine** that helps at generating HTML pages.

                            https://expressjs.com/

                            Notes:

                            The line between middleware and router is sometimes blurry. The middleware layer is usually used to process the request and response, while the router is used to map the request to the appropriate code.
                            
                        </textarea>
                    </section>

                    <section data-markdown style="font-size: 0.8em;">
                        <textarea data-template>
                            ## <i class="fas fa-hand-paper"></i> ExpressJS (Server-side)

                            ```js
                            const express = require('express')
                            
                            // Create an express app
                            const app = express();
                            
                            // Serve GET requests on a given url
                            app.get(url, (req, res) => {
                                // handle request (req.cookies, req.body, req.ip, req.query)
                                let args = req.query // Object with one property per url parameter
                                // handle response (res.status, res.redirect, res.json)
                                res.status(200)
                                res.send(...); // Sends an HTTP response
                            });
                            
                            // Serve POST requests on a given url. Similar exist for PUT and DELETE requests.
                            app.post(url, (req, res) => { ... });
                            
                            // Serve static files (images, css files, js files, etc) in a given directory
                            app.use(express.static(dir_name));
                            
                            // Launch the server
                            app.listen(port);
                            ```

                            https://github.com/web-classroom/example-express

                            Notes:

                            The callback functions passed to the app.get and app.post methods are called **middleware**. There can be multiple per route, and they are executed in the order they are defined, where the last one in the chain sends the response back to the client. One can also jump to the next middleware early using the next() function. They are used to process the request and response. Technically, the application's logic runs in the context of a middleware, but it is common to separate the code handling HTTP requests and responses from the code implementing the application's logic.
                            
                        </textarea>
                    </section>

                    <section data-markdown style="font-size: 0.6em;">
                        <textarea data-template>
                            ## <i class="fas fa-hand-paper"></i>  Multi-page applications (MPA)

                            It is the traditional solution : for each request, a new page is retrieved and entirely rendered, even if the change affects only a small part of the page.
                            
                            Most common type of web application, strongly based on the client-server model, typically written in a server-side language (PHP, Python, or Java).

                            When in doubt, start with a multi-page application.
                            
                            ### Advantages
                            Easy to develop, maintain, scale, test, secure, reference, deploy, and debug.

                            ### Disadvantages
                            Not very user-friendly, not very responsive, not very interactive.
                        </textarea>
                    </section>

                    <section data-markdown style="font-size: 0.6em;">
                        <textarea data-template>
                            ## <i class="fas fa-hand-paper"></i> MVC Pattern
                            
                            The Model-View-Controller (MVC) architectural pattern is commonly used for separating concerns of (1) data, (2) user interface, and (3) program logic.

                            - The **model** is responsible for managing the data. It notifies the view of any changes in the data, and reacts to notifications from the controller.
                            - The **view** is responsible for displaying the data to the user. It receives data from the model and sends user actions (e.g. button clicks) to the controller.
                            - The **controller** is responsible for handling user actions and updating the model and the view accordingly.

                            This allows for separation of concerns, code reuse, and parallel development. It is often used to organize the code in a multi-page application.

                        </textarea>
                    </section>

                    <section data-markdown style="font-size: 0.6em;">
                        <textarea data-template>
                            ## <i class="fas fa-hand-paper"></i> MPA and MVC in the real world

                            **Stackoverflow** is a multi-page application that uses the MVC pattern.

                            **Hacker News** is a multi-page application that uses the MVC pattern.
                            
                            **Facebook** and **Reddit** started as a multi-page application that used the MVC pattern.
                            
                            When exposed to trendy Web technologies, do a quick sanity check on BuildWith.

                            https://trends.builtwith.com/

                        </textarea>
                    </section>


                </section>

                <section>
                    <section data-markdown style="font-size: 0.6em;">
                        <textarea data-template>
                            ## <i class="fas fa-hand-paper"></i> Évaluation du cours

                            Prenez 3 minutes pour remplir le formulaire suivant, afin de partager vos retours sur le cours.

                            https://framaforms.org/heig-vd-technologies-web-satisfaction-et-commentaires-1697270462

                        </textarea>
                    </section>
                </section>       
            </div>
		</div>
        
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/reveal.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/plugin/markdown/markdown.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/plugin/highlight/highlight.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/plugin/notes/notes.js"></script>
        <script src="./script.js" type="module"></script>

	</body>
</html>
